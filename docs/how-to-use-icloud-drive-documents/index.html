<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://theswiftdev.com/how-to-use-icloud-drive-documents/">
    
    

    <title>How to use iCloud drive documents? - The.Swift.Dev.</title>
    <meta name="description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">

    <meta property="og:url" content="https://theswiftdev.com/how-to-use-icloud-drive-documents/">
    <meta property="og:title" content="How to use iCloud drive documents? - The.Swift.Dev.">
    <meta property="og:description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">
    

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="How to use iCloud drive documents? - The.Swift.Dev.">
    <meta name="twitter:description" content="Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.">
    

    <link rel="stylesheet" href="https://theswiftdev.com/css/modern-normalize.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/modern-base.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/variables.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/base.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/grid.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/navigation.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/footer.css">
    

    

    <link rel="shortcut icon" href="https://theswiftdev.com/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://theswiftdev.com/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://theswiftdev.com/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://theswiftdev.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://theswiftdev.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://theswiftdev.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://theswiftdev.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://theswiftdev.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://theswiftdev.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://theswiftdev.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://theswiftdev.com/icons/apple-touch-icon-180x180.png">

    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
        media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        media="(prefers-color-scheme: dark)"
    >
    <link rel="stylesheet" href="https://theswiftdev.com/css/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

</head>

<body>
    <div id="site-container">

    <header id="navigation">
        <a href="/">
            <picture>
                <img
                    src="https://theswiftdev.com/images/logos/logo.png"
                    alt="Logo of The.Swift.Dev."
                    title="The.Swift.Dev."
                >
            </picture>
        </a>
        <nav>
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/page/1/">Posts</a>
                <a href="/tags/">Tags</a>
                <a href="/authors/">Authors</a>
                <a href="/practical-server-side-swift/">My Book</a>
            </div>
        </nav>
    </header>

    <main id="page-container">
    
    <div class="article-with-toc">
        <div>
            <article class="post">
                <div class="meta">
                    <time datetime="2018/05/17">2018/05/17</time>
                     &middot; <span class="reading-time">3 min read</span>
                    
                </div>
                <h1>How to use iCloud drive documents?</h1>
                <hr>
                <p>Learn how to sync files and data through a shared iCloud drive folder using the latest version of Swift programming language.</p>
                <section>
                
                <h2 id="icloud-drive-project-setup-tutorial">iCloud drive project setup tutorial</h2><p>Let‚Äôs start by creating a new project for iOS. You can select the single view application template, don‚Äôt worry too much about document based apps, because in this tutorial we‚Äôre not going to touch the <code>UIDocument</code> class at all. ü§∑‚Äç‚ôÇÔ∏è</p><p>    <img src="/assets/how-to-use-icloud-drive-documents/capabilities.png" alt="Capabilities"></p><p>The first step is to enable iCloud capabilities, which will generate a new entitlements file for you. Also you‚Äôll have to enable the iCloud application service for the app id on the <a href="https://developer.apple.com/account/ios/identifier/bundle" target="_blank">Apple developer</a> portal. You should also assign the iCloud container that‚Äôs going to be used to store data. Just a few clicks, but you have to do this manually. üí©</p><blockquote><p>NOTE: You need a valid Apple Developer Program membership in order to set <a href="https://developer.apple.com/support/app-capabilities/" target="_blank">advanced app capabilities</a> like iCloud support. So you have to pay $99/year. #greed ü§ë</p></blockquote><p>    <img src="/assets/how-to-use-icloud-drive-documents/icloud.png" alt="iCloud"></p><p>So I believe that now you have a proper iOS app identifier with iCloud capabilities and application services enabled. One last step is ahead, you have to add these few lines to your <code>Info.plist</code> file in order to define the <a href="https://medium.com/ios-os-x-development/icloud-drive-documents-1a46b5706fe1" target="_blank">iCloud drive</a> container (folder name) that you‚Äôre going to use. Note that you can have multiple containers for one app.</p><pre><code class="language-xml">&lt;key&gt;NSUbiquitousContainers&lt;/key&gt;
&lt;dict&gt;
    &lt;key&gt;iCloud.com.tiborbodecs.teszt&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;NSUbiquitousContainerIsDocumentScopePublic&lt;/key&gt;
        &lt;true/&gt;
        &lt;key&gt;NSUbiquitousContainerName&lt;/key&gt;
        &lt;string&gt;Teszt&lt;/string&gt;
        &lt;key&gt;NSUbiquitousContainerSupportedFolderLevels&lt;/key&gt;
        &lt;string&gt;Any&lt;/string&gt;
    &lt;/dict&gt;
&lt;/dict&gt;
</code></pre><p>Finally we‚Äôre ready to move forward with some actual coding. üíª</p><h2 id="files-inside-icloud-drive-containers">Files inside iCloud drive containers</h2><p>Working with iCloud files using Swift is relatively easy. Basically you just have to get the base URL of your iCloud drive container, and you can do whatever you want. ü§î However I‚Äôll show you some best practices & tricks.</p><p>First you have to check if your container folder already exists, if not you should create it by hand using the FileManager class. I‚Äôve also made a ‚Äúshortcut‚Äù variable for the container base URL, so I don‚Äôt have to write all those long words again. üòÖ</p><pre><code class="language-swift">var containerUrl: URL? {
    FileManager.default.url(
        forUbiquityContainerIdentifier: nil
    )?.appendingPathComponent("Documents")
}
// check for container existence
if 
    let url = self.containerUrl, 
    !FileManager.default.fileExists(
        atPath: url.path, 
        isDirectory: nil
    ) {
    do {
        try FileManager.default.createDirectory(
            at: url, withIntermediateDirectories: true, 
            attributes: nil
        )
    }
    catch {
        print(error.localizedDescription)
    }
}
</code></pre><p>Working with paths inside the iCloud drive container is simple, you can append path components to the base URL and use that exact location URL as you want.</p><pre><code class="language-swift">let myDocumentUrl = self.containerUrl?
    .appendingPathComponent(subDirectory)
    .appendingPathComponent(fileName)
    .appendingPathExtension(fileExtension)
</code></pre><p>Picking existing files is also quite straightforward. You can use the built-in document picker class from UIKit. There are only two catches here. ü§¶‚Äç‚ôÇÔ∏è</p><p>First one is that you need to provide the type of the documents that you‚Äôd like to access. Have you ever heard about <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_intro/understand_utis_intro.html#//apple_ref/doc/uid/TP40001319-CH201-SW1" target="_blank">UTI</a>‚Äôs? No? Maybe yes‚Ä¶? The thing is that you have to find the proper <a href="https://developer.apple.com/library/content/documentation/FileManagement/Conceptual/understanding_utis/understand_utis_declare/understand_utis_declare.html#//apple_ref/doc/uid/TP40001319-CH204-SW1" target="_blank">uniform type identifier</a> for every file type, instead of providing an extension or mime-type or something commonly used thing. Smart one, huh? üß†</p><pre><code class="language-swift">let picker = UIDocumentPickerViewController(
    documentTypes: ["public.json"], 
    in: .open
)
picker.delegate = self
picker.modalPresentationStyle = .fullScreen
self.present(picker, animated: true, completion: nil)
</code></pre><p>The second catch is that you have to ‚Äúunlock‚Äù the picked file before you start reading it. That can be done by calling the <code>startAccessingSecurityScopedResource</code> method. Don‚Äôt forget to call the stopAccessingSecurityScopedResource method, or things are going to be out of balance. You don‚Äôt want that, trust me! #snap üß§</p><pre><code class="language-swift">func documentPicker(
    _ controller: UIDocumentPickerViewController, 
    didPickDocumentsAt urls: [URL]
) {
    guard
        controller.documentPickerMode == .open,
        let url = urls.first,
        url.startAccessingSecurityScopedResource()
    else {
        return
    }
    defer {
        url.stopAccessingSecurityScopedResource()
    }
    // do some work with the url
}
</code></pre><p>Everything else works as you‚Äôd expect. You can save files directly into the container through file APIs or by using the <code>UIDocumentPickerViewController</code> instance. Here are some of the most common api calls, that you can use to manipulate files.</p><pre><code class="language-swift">// string
try string.write(to: url, atomically: true, encoding: .utf8)
try String(contentsOf: url)

// data
try data.write(to: url, options: [.atomic])
try Data(contentsOf: url)

// file manager
FileManager.default.copyItem(at: local, to: url)
FileManager.default.removeItem(at: url)
</code></pre><p>You can read and write any kind of string, data. By using the <code>FileManager</code> you can copy, move, delete items or change file attributes. All your documents stored inside iCloud drive will be magically available on every device. Obviously you have to be logged in with your iCloud account, and have enough free storage. üí∞</p><h2 id="debugging">Debugging</h2><p>If you alter something in your settings you might want to increment your build number as well in order to notify the operating system about the changes. üí°</p><p>On the mac all the iCloud drive files / containers are located under the user‚Äôs Library folder inside the Mobile Documents directory. You can simply use the Terminal or Finder to go there and list all the files. Pro tip: look for hidden ones as well! üòâ</p><pre><code class="language-sh">cd ~/Library/Mobile\ Documents
ls -la
# ls -la|grep tiborbodecs
</code></pre><p>You can also monitor the activity of the CloudDocs daemon, by using this command:</p><pre><code class="language-sh"># man brctl
brctl log --wait --shorten
</code></pre><p>The output will tell you what‚Äôs actually happening during the sync.</p><p>    <img src="/assets/how-to-use-icloud-drive-documents/debug.png" alt="Debug"></p><p>I encourage you to check the manual entry for the <code>brctl</code> command, because there are a few more flags that can make troubleshooting more easy. ü§ê</p><p>This article was heavily inspired by <a href="https://x.com/krzyzanowskim" target="_blank">Marcin Krzyzanowski</a>‚Äôs really old blog post. üç∫</p>
                    
                </section>
    
                <footer>
                    <br>
                    <time datetime=""></time>
    
                    
                    <div class="author-list">
                        <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                        <img class="small rounded" src="/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                        </a>
                    </div>
                    <div class="tag-list">
                        <a href="https://theswiftdev.com/tags/ios/"><small>iOS</small></a>
                    </div>
                    
                    <p>
                        <a href="https://x.com/intent/tweet?via=tiborbodecs&amp;hashtags=SwiftLang&amp;url=https://theswiftdev.com/how-to-use-icloud-drive-documents/" target="_blank">
                            <strong>Share this article</strong>
                        </a>
                        <br>Thank you. üôè
                    </p>
                </footer>
                            
                <section class="group">
                    <h4>Related posts</h4>                
                    <div class="grid grid-221">
                        <div class="card">
                            
                            
                            <div class="author-list">
                            </div>
                            <div class="meta">
                                <time datetime="2018/10/16">2018/10/16</time>
                                
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/custom-uiview-subclass-from-a-xib-file/" target="">Custom UIView subclass from a xib file</a></h2>
                            <hr>
                            <p>Do you want to learn how to load a xib file to create a custom view object? Well, this UIKit tutorial is just for you written in Swift.</p>
                        
                            <div class="tag-list">
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                            </div>
                            <div class="meta">
                                <time datetime="2017/10/31">2017/10/31</time>
                                
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/ios-auto-layout-tutorial-programmatically/" target="">iOS Auto Layout tutorial programmatically</a></h2>
                            <hr>
                            <p>In this great iOS Auto Layout tutorial I&#39;ll teach you how to support rotation, use constraints, work with layers, animate corner radius.</p>
                        
                            <div class="tag-list">
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                            </div>
                            <div class="meta">
                                <time datetime="2018/04/26">2018/04/26</time>
                                
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/ios-custom-transition-tutorial-in-swift/" target="">iOS custom transition tutorial in Swift</a></h2>
                            <hr>
                            <p>In this tutorial, you&#39;ll learn how to replace the push, pop and modal animations with custom transitions &amp; percent driven interactions.</p>
                        
                            <div class="tag-list">
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                            </div>
                            <div class="meta">
                                <time datetime="2018/06/14">2018/06/14</time>
                                
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/mastering-ios-auto-layout-anchors-programmatically-from-swift/" target="">Mastering iOS auto layout anchors programmatically from Swift</a></h2>
                            <hr>
                            <p>Looking for best practices of using layout anchors? Let&#39;s learn how to use the iOS autolayout system in the proper way using Swift.</p>
                        
                            <div class="tag-list">
                            </div>
                        </div>
                    </div>
                </section>
    
            </article>
        </div>
        
        <div>
            <div class="book">
                <a href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">
                    <img src="https://theswiftdev.com/book/practical-server-side-swift-cover.png" alt="Practical Server Side Swift cover image">
                </a>
                <h3>
                    <a href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">Get the Practical Server Side Swift book</a>
                </h3>
                <p>Swift on the server is an amazing new opportunity to build fast, safe and scalable backend apps. Write your very first web-based application by using your favorite programming language. Learn how to build a modular blog engine using the latest version of the Vapor 4 framework. This book will help you to design and create modern APIs that'll allow you to share code between the server side and iOS. Start becoming a full-stack Swift developer.</p>
                <a class="cta" href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">Available on Gumroad</a>
            </div>
            
            
            <aside id="toc">
                <h4>On this page</h4>
                <ul>
                    <li class="first-level">
                        <a href="#icloud-drive-project-setup-tutorial">iCloud drive project setup tutorial</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#files-inside-icloud-drive-containers">Files inside iCloud drive containers</a>
                        <ul>
                        </ul>
                    </li>
        <li class="first-level">
                        <a href="#debugging">Debugging</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </aside>
            
    
        </div>
    </div>
    
    </main>

    <footer id="site-footer">
        <div class="grid grid-421">
    
            <picture>
                <img
                    id="logo-image"
                    src="https://theswiftdev.com/images/logos/logo-large.png"
                    alt="Logo of The.Swift.Dev."
                    title="The.Swift.Dev."
                >
            </picture>
            
            <div>
                <span style="display: block; height: 32px;">&nbsp;</span>
                <h4>The.Swift.Dev</h4>
                <p><small><a href="https://theswiftdev.com/" target="_blank">theswiftdev.com</a></small></p>
                <ul>
                    <li><a href="https://github.com/theswiftdev/" target="_blank">GitHub</a></li>
                    <li><a href="https://theswiftdev.com/rss.xml" target="_blank">RSS</a></li>
                    <li><a href="https://theswiftdev.com/sitemap.xml" target="_blank">Sitemap</a></li>
                </ul>
            </div>
            
            <div>
                
            </div>
            
            <div>
                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                </a>
                <h4><a href="https://theswiftdev.com/authors/tibor-bodecs/">Tibor B√∂decs</a></h4>
                <p><small><a href="https://binarybirds.com/" target="_blank">Binary Birds Kft.</a></small></p>
                <ul>
                    <li><a href="mailto:mail.tib@gmail.com" target="_blank">Email</a></li>
                    <li><a href="https://github.com/tib/" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/tiborbodecs" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@tiborbodecs" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
        </div>
        
        <section class="grid grid-221">
            <small>Tibor B√∂decs &copy; 2015 - 2024</small>
            <small>This site was generated using <a href="https://swift.org/" target="_blank">Swift</a> & <a href="https://github.com/binarybirds/toucan" target="_blank">Toucan</a>.</small>
        </section>
    </footer>

    </div>

    
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Progressive Web Apps on iOS - The.Swift.Dev.</title>
    
    <meta name="description" content="This is a beginner's guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">
    
    <meta property="og:title" content="Progressive Web Apps on iOS - The.Swift.Dev.">
    <meta property="og:description" content="This is a beginner's guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">
    <meta property="og:url" content="https://theswiftdev.com/progressive-web-apps-on-ios">
    <meta property="og:image" content="https://theswiftdev.com/images/assets/progressive-web-apps-on-ios/cover.jpg">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@tiborbodecs">
    <meta name="twitter:creator" content="@tiborbodecs">
    <meta name="twitter:title" content="Progressive Web Apps on iOS - The.Swift.Dev.">
    <meta name="twitter:description" content="This is a beginner's guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.">
    <meta name="twitter:image" content="https://theswiftdev.com/images/assets/progressive-web-apps-on-ios/cover.jpg">
    
    <link rel="stylesheet" href="https://theswiftdev.com/css/style.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/syntax.css">
    
    <link rel="mask-icon" sizes="any" href="https://theswiftdev.com/images/icons/icon.svg">

    <link rel="shortcut icon" href="https://theswiftdev.com/images/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://theswiftdev.com/images/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://theswiftdev.com/images/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://theswiftdev.com/images/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://theswiftdev.com/images/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://theswiftdev.com/images/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://theswiftdev.com/images/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://theswiftdev.com/images/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://theswiftdev.com/images/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://theswiftdev.com/images/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://theswiftdev.com/images/icons/apple-touch-icon-180x180.png">
    
</head>

<body>
    <a href="https://theswiftdev.gumroad.com" class="ribbon">
        üìñ
    </a>
    <header id="page-header">
        <a href="https://theswiftdev.com/">
            <img 
                id="logo-image"
                src="https://theswiftdev.com/images/icons/icon-320.png"
                alt="Logo of The.Swift.Dev." 
                title="The.Swift.Dev."
            >
        </a>
    </header>
    
    <main>

        <article>
    <header>
        <section id="post-header" class="content-wrapper">
            <time datetime="2022/01/27">2022/01/27</time>
            <h1 class="title">Progressive Web Apps on iOS</h1>
            <p class="excerpt">This is a beginner's guide about creating PWAs for iOS including custom icons, splash screens, safe area and dark mode support.</p>
            <div class="meta">
                <span class="tag">iOS</span>
<span class="tag">PWA</span>
            </div>
        </section>
        <section class="wrapper">
            <img id="post-image" src="https://theswiftdev.com/images/assets/progressive-web-apps-on-ios/cover.jpg">
        </section>
    </header>

    <div id="contents">
        <section class="content-wrapper">
            <h2>How to make a PWA for iOS?</h2><p>A <a href="https://en.wikipedia.org/wiki/Progressive_web_application" target="_blank">progressive web application</a> is just a special kind of website, that can look and behave like a native iOS app. In order to build a PWA, first we're going to create a regular website using <a href="https://github.com/BinaryBirds/swift-html" target="_blank">SwiftHtml</a>. We can start with a regular executable Swift package with the following dependencies.</p><pre><code class="language-swift"><span class="comment">// swift-tools-version:5.5</span>
<span class="keyword">import</span> PackageDescription

<span class="keyword">let</span> package = <span class="type">Package</span>(
    name: <span class="string">"Example"</span>,
    platforms: [
        .<span class="call">macOS</span>(.<span class="dotAccess">v12</span>)
    ],
    dependencies: [
        .<span class="call">package</span>(url: <span class="string">"https://github.com/binarybirds/swift-html"</span>, from: <span class="string">"1.2.0"</span>),
        .<span class="call">package</span>(url: <span class="string">"https://github.com/vapor/vapor"</span>, from: <span class="string">"4.54.0"</span>),
    ],
    targets: [
        .<span class="call">executableTarget</span>(name: <span class="string">"Example"</span>, dependencies: [
            .<span class="call">product</span>(name: <span class="string">"SwiftHtml"</span>, package: <span class="string">"swift-html"</span>),
            .<span class="call">product</span>(name: <span class="string">"Vapor"</span>, package: <span class="string">"vapor"</span>),
        ]),
        .<span class="call">testTarget</span>(name: <span class="string">"ExampleTests"</span>, dependencies: [<span class="string">"Example"</span>]),
    ]
)</code></pre><p>As you can see we're going to use the vapor <a href="https://vapor.codes/" target="_blank">Vapor</a> library to serve our HTML site. If you don't know much about Vapor let's just say that it is a web application framework, which can be used to build server side Swift applications, it's a pretty amazing tool I have a <a href="https://theswiftdev.com/beginners-guide-to-server-side-swift-using-vapor-4/">beginner's guide</a> post about it.</p><p>Of course we're going to need some components for rendering views using SwiftHtml, you can use the source snippets from <a href="https://theswiftdev.com/how-to-write-html-in-swift/">my previous article</a>, but here it is again how the SwiftHtml-based template engine should look like. You should read my other article if you want to know more about it. ü§ì</p><pre><code class="language-swift"><span class="keyword">import</span> Vapor
<span class="keyword">import</span> SwiftSgml

<span class="keyword">public protocol</span> TemplateRepresentable {
    
    <span class="keyword">@TagBuilder
    func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span>
}

<span class="keyword">public struct</span> TemplateRenderer {
    
    <span class="keyword">var</span> req: <span class="type">Request</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> req: <span class="type">Request</span>) {
        <span class="keyword">self</span>.<span class="property">req</span> = req
    }

    <span class="keyword">public func</span> renderHtml(<span class="keyword">_</span> template: <span class="type">TemplateRepresentable</span>, minify: <span class="type">Bool</span> = <span class="keyword">false</span>, indent: <span class="type">Int</span> = <span class="number">4</span>) -&gt; <span class="type">Response</span> {
        <span class="keyword">let</span> doc = <span class="type">Document</span>(.<span class="dotAccess">html</span>) { template.<span class="call">render</span>(req) }
        <span class="keyword">let</span> body = <span class="type">DocumentRenderer</span>(minify: minify, indent: indent).<span class="call">render</span>(doc)
        <span class="keyword">return</span> <span class="type">Response</span>(status: .<span class="dotAccess">ok</span>, headers: [<span class="string">"content-type"</span>: <span class="string">"text/html"</span>], body: .<span class="keyword">init</span>(string: body))
    }
}

<span class="keyword">public extension</span> <span class="type">Request</span> {
    <span class="keyword">var</span> templates: <span class="type">TemplateRenderer</span> { .<span class="keyword">init</span>(<span class="keyword">self</span>) }
}</code></pre><p>We're also going to need an index template for our main HTML document. Since we're using a Swift DSL to write HTML code we don't have to worry too much about mistyping a tag, the compiler will protect us and helps to maintain a completely valid HTML structure.</p><pre><code class="language-swift"><span class="keyword">import</span> Vapor
<span class="keyword">import</span> SwiftHtml


<span class="keyword">struct</span> IndexContext {
    <span class="keyword">let</span> title: <span class="type">String</span>
    <span class="keyword">let</span> message: <span class="type">String</span>
}

<span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="keyword">let</span> context: <span class="type">IndexContext</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> context: <span class="type">IndexContext</span>) {
        <span class="keyword">self</span>.<span class="property">context</span> = context
    }
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="type">Title</span>(context.<span class="property">title</span>)
                
                <span class="type">Meta</span>().<span class="call">charset</span>(<span class="string">"utf-8"</span>)
                <span class="type">Meta</span>().<span class="call">name</span>(.<span class="dotAccess">viewport</span>).<span class="call">content</span>(<span class="string">"width=device-width, initial-scale=1"</span>)
            }
            <span class="type">Body</span> {
                <span class="type">Main</span> {
                    <span class="type">Div</span> {
                        <span class="type">H1</span>(context.<span class="property">title</span>)
                        <span class="type">P</span>(context.<span class="property">message</span>)
                    }
                }
            }
        }
    }
}</code></pre><p>Finally we can simply render the bootstrap our Vapor server instance, register our route handler and render the index template inside the main entry point of our Swift package by using the previously defined template helper methods on the Request object.</p><pre><code class="language-swift"><span class="keyword">import</span> Vapor
<span class="keyword">import</span> SwiftHtml

<span class="keyword">var</span> env = <span class="keyword">try</span> <span class="type">Environment</span>.<span class="call">detect</span>()
<span class="keyword">try</span> <span class="type">LoggingSystem</span>.<span class="call">bootstrap</span>(from: &amp;env)
<span class="keyword">let</span> app = <span class="type">Application</span>(env)
<span class="keyword">defer</span> { app.<span class="call">shutdown</span>() }

app.<span class="call">get</span> { req -&gt; <span class="type">Response</span> <span class="keyword">in
    let</span> template = <span class="type">IndexTemplate</span>(.<span class="keyword">init</span>(title: <span class="string">"Hello, World!"</span>,
                                    message: <span class="string">"This page was generated by the SwiftHtml library."</span>))
    
    <span class="keyword">return</span> req.<span class="property">templates</span>.<span class="call">renderHtml</span>(template)
}

<span class="keyword">try</span> app.<span class="call">run</span>()</code></pre><p>It is just that easy to setup and bootstrap a fully working web server that is capable of rendering a HTML document using the power of Swift and the Vapor framework. If you run the app you should be able to see a working website by visiting the http://localhost:8080/ address.</p><h2>Turning a website into a real iOS PWA</h2><p>Now if we want to transform our website into a standalone PWA, we have to provide a link a special <a href="https://web.dev/add-manifest/" target="_blank">web app manifest</a> file inside the head section of the index template.</p><h3>Meta tags vs manifest.json</h3><p>Seems like Apple follows kind of a strange route if it comes to PWA support. They have quite a history of "thinking outside of the box", this mindset applies to progressive web apps on iOS, since they don't tend to follow the standards at all. For Android devices you could create a <a href="https://web.dev/add-manifest/" target="_blank">manifest.json</a> file with some predefined keys and you'd be just fine with your PWA. On the other hand Apple nowadays prefers various <a href="https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html" target="_blank">HTML meta tags</a> instead of the web manifest format.</p><p>Personally I don't like this approach, because your HTML code will be bloated with all the PWA related stuff (as you'll see this is going to happen if it comes to launch screen images) and I believe it's better to separate these kind of things, but hey it's Apple, they can't be wrong, right? üòÖ</p><p>Anyways, let me show you how to support various PWA features on iOS.</p><h3>Enabling standalone app mode</h3><p>The very first few keys that we'd like to add to the index template has the apple-mobile-web-app-capable name and you should use the "yes" string as content. This will indicate that the app should run in full-screen mode, otherwise it's going to be displayed using Safari just like a regular site.</p><pre><code class="language-swift"><span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="keyword">let</span> context: <span class="type">IndexContext</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> context: <span class="type">IndexContext</span>) {
        <span class="keyword">self</span>.<span class="property">context</span> = context
    }
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="type">Title</span>(context.<span class="property">title</span>)
                
                <span class="type">Meta</span>().<span class="call">charset</span>(<span class="string">"utf-8"</span>)
                <span class="type">Meta</span>().<span class="call">name</span>(.<span class="dotAccess">viewport</span>).<span class="call">content</span>(<span class="string">"width=device-width, initial-scale=1"</span>)

                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppCapable</span>)
                    .<span class="call">content</span>(<span class="string">"yes"</span>)
            }
            <span class="type">Body</span> {
                <span class="type">Main</span> {
                    <span class="type">Div</span> {
                        <span class="type">H1</span>(context.<span class="property">title</span>)
                        <span class="type">P</span>(context.<span class="property">message</span>)
                    }
                }
            }
        }
    }
}</code></pre><p>We should change the hostname of the server and listen on the 0.0.0.0 address, this way if your phone is on the same local WiFi network you should be able to reach your web server directly.</p><pre><code class="language-swift"><span class="keyword">import</span> Vapor
<span class="keyword">import</span> SwiftHtml

<span class="keyword">var</span> env = <span class="keyword">try</span> <span class="type">Environment</span>.<span class="call">detect</span>()
<span class="keyword">try</span> <span class="type">LoggingSystem</span>.<span class="call">bootstrap</span>(from: &amp;env)
<span class="keyword">let</span> app = <span class="type">Application</span>(env)
<span class="keyword">defer</span> { app.<span class="call">shutdown</span>() }

app.<span class="property">http</span>.<span class="property">server</span>.<span class="property">configuration</span>.<span class="property">hostname</span> = <span class="string">"0.0.0.0"</span>
<span class="keyword">if let</span> hostname = <span class="type">Environment</span>.<span class="call">get</span>(<span class="string">"SERVER_HOSTNAME"</span>) {
    app.<span class="property">http</span>.<span class="property">server</span>.<span class="property">configuration</span>.<span class="property">hostname</span> = hostname
}

app.<span class="call">get</span> { req -&gt; <span class="type">Response</span> <span class="keyword">in
    let</span> template = <span class="type">IndexTemplate</span>(.<span class="keyword">init</span>(title: <span class="string">"Hello, World!"</span>,
                                    message: <span class="string">"This page was generated by the SwiftHtml library."</span>))
    
    <span class="keyword">return</span> req.<span class="property">templates</span>.<span class="call">renderHtml</span>(template)
}

<span class="keyword">try</span> app.<span class="call">run</span>()</code></pre><p>You can find out your <a href="https://stackoverflow.com/questions/13322485/how-to-get-the-primary-ip-address-of-the-local-machine-on-linux-and-os-x" target="_blank">local IP address</a> by typing the following command into the Terminal app.</p><pre><code class="language-sh"># using ifconfig &amp; grep
ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1'
# using ifconfig &amp; sed
ifconfig | sed -En 's/127.0.0.1//;s/.*inet (addr:)?(([0-9]*\.){3}[0-9]*).*/\2/p'
</code></pre><p>Just use that IP address and go to the http://[ip-address]:8080/ website using your iOS device, then you should be able to add your website to your home screen as a bookmark. Just tap the Share icon using Safari and select the Add to Home Screen menu item from the list. On the new screen tap the Add button on the top right corner, this will create a new icon on your home screen as a bookmark to your page. Optionally, you can provide a custom name for the bookmark. ‚ò∫Ô∏è</p><p>Since we've added the meta tag, if you touch the newly created icon it should open the webpage as a standalone app (without using the browser). Of course the app is still just a website rendered using a web view. The status bar won't match the white background and it has no custom icon or splash screen yet, but we're going to fix those issues right now. üì±</p><h3>Custom name and icon</h3><p>To provide a custom name we just have to add a new meta tag, fortunately the SwiftHtml library has predefined enums for all the Apple related meta names, so you don't have to type that much. The icon situation is a bit more difficult, since we have to add a bunch of size variants.</p><pre><code class="language-swift"><span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="keyword">let</span> context: <span class="type">IndexContext</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> context: <span class="type">IndexContext</span>) {
        <span class="keyword">self</span>.<span class="property">context</span> = context
    }
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="type">Title</span>(context.<span class="property">title</span>)
                
                <span class="type">Meta</span>().<span class="call">charset</span>(<span class="string">"utf-8"</span>)
                <span class="type">Meta</span>().<span class="call">name</span>(.<span class="dotAccess">viewport</span>).<span class="call">content</span>(<span class="string">"width=device-width, initial-scale=1"</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppCapable</span>)
                    .<span class="call">content</span>(<span class="string">"yes"</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppTitle</span>)
                    .<span class="call">content</span>(<span class="string">"Hello PWA"</span>)
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                    .<span class="call">href</span>(<span class="string">"/img/apple/icons/192.png"</span>)

                <span class="keyword">for</span> size <span class="keyword">in</span> [<span class="number">57</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">114</span>, <span class="number">120</span>, <span class="number">144</span>, <span class="number">152</span>, <span class="number">180</span>] {
                    <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                        .<span class="call">sizes</span>(<span class="string">"</span>\(size)<span class="string">x</span>\(size)<span class="string">"</span>)
                        .<span class="call">href</span>(<span class="string">"/img/apple/icons/</span>\(size)<span class="string">.png"</span>)
                }
            }
            <span class="type">Body</span> {
                <span class="type">Main</span> {
                    <span class="type">Div</span> {
                        <span class="type">H1</span>(context.<span class="property">title</span>)
                        <span class="type">P</span>(context.<span class="property">message</span>)
                    }
                }
            }
        }
    }
}</code></pre><p>As you can see icons are referenced by using the Link tag, using the Apple touch icon rel attribute. The default icon without the sizes attribute can be a 192x192 pixel image, plus I'm providing some smaller sizes by using a for loop here. We also need to serve these icon files by using Vapor, that's why we're going to alter the configuration file and enable the FileFiddleware.</p><pre><code class="language-swift"><span class="keyword">import</span> Vapor
<span class="keyword">import</span> SwiftHtml

<span class="keyword">var</span> env = <span class="keyword">try</span> <span class="type">Environment</span>.<span class="call">detect</span>()
<span class="keyword">try</span> <span class="type">LoggingSystem</span>.<span class="call">bootstrap</span>(from: &amp;env)
<span class="keyword">let</span> app = <span class="type">Application</span>(env)
<span class="keyword">defer</span> { app.<span class="call">shutdown</span>() }

app.<span class="property">middleware</span>.<span class="call">use</span>(<span class="type">FileMiddleware</span>(publicDirectory: app.<span class="property">directory</span>.<span class="property">publicDirectory</span>))

app.<span class="property">http</span>.<span class="property">server</span>.<span class="property">configuration</span>.<span class="property">hostname</span> = <span class="string">"0.0.0.0"</span>
<span class="keyword">if let</span> hostname = <span class="type">Environment</span>.<span class="call">get</span>(<span class="string">"SERVER_HOSTNAME"</span>) {
    app.<span class="property">http</span>.<span class="property">server</span>.<span class="property">configuration</span>.<span class="property">hostname</span> = hostname
}

app.<span class="call">get</span> { req -&gt; <span class="type">Response</span> <span class="keyword">in
    let</span> template = <span class="type">IndexTemplate</span>(.<span class="keyword">init</span>(title: <span class="string">"Hello, World!"</span>,
                                    message: <span class="string">"This page was generated by the SwiftHtml library."</span>))
    
    <span class="keyword">return</span> req.<span class="property">templates</span>.<span class="call">renderHtml</span>(template)
}

<span class="keyword">try</span> app.<span class="call">run</span>()</code></pre><p>By adding the FileMiddleware to the app with the public directory path configuration your server app is able to serve static files from the Public directory. Feel free to create it and place the app icons under the Public/img/apple/icons folder. If you are running the server from the command line you'll be fine, but if you are using Xcode you have to specify a <a href="https://theswiftdev.com/custom-working-directory-in-xcode/">custom working directory for Vapor</a>, this will allow the system to look up the public files from the right place.</p><p class="note">Your custom icons <a href="https://developer.apple.com/forums/thread/92304" target="_blank">won't show up</a> if you are using a self-signed certificate.</p><p>Build and run the server and try to bookmark your page again using your phone. When you see the add bookmark page you should be able to validate that the app now uses the predefined Hello PWA name and the image preview should show the custom icon file instead of a screenshot of the page.</p><h3>Proper status bar color for iOS PWAs</h3><p>Long story short, there is a great article on <a href="https://css-tricks.com/meta-theme-color-and-trickery/" target="_blank">CSS-Tricks</a> about the most recent version of Safari and how it handles various theme colors on different platforms. It's a great article, you should definitely read it, but in most of the cases you won't need this much info, but you simply want to support light and dark mode for your progressive web app. That's what I'm going to show you here.</p><p>For light mode we're going to use a white background color and for dark mode we use black. We're also going to link a new style.css file so we can change the background of the site and the font color according to the current color scheme. First, the new meta tags to support theme colors both for light and dark mode.</p><pre><code class="language-swift"><span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="keyword">let</span> context: <span class="type">IndexContext</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> context: <span class="type">IndexContext</span>) {
        <span class="keyword">self</span>.<span class="property">context</span> = context
    }
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="type">Title</span>(context.<span class="property">title</span>)
                
                <span class="type">Meta</span>().<span class="call">charset</span>(<span class="string">"utf-8"</span>)
                <span class="type">Meta</span>().<span class="call">name</span>(.<span class="dotAccess">viewport</span>).<span class="call">content</span>(<span class="string">"width=device-width, initial-scale=1"</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppCapable</span>)
                    .<span class="call">content</span>(<span class="string">"yes"</span>)
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppTitle</span>)
                    .<span class="call">content</span>(<span class="string">"Hello PWA"</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">colorScheme</span>)
                    .<span class="call">content</span>(<span class="string">"light dark"</span>)
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">themeColor</span>)
                    .<span class="call">content</span>(<span class="string">"#fff"</span>)
                    .<span class="call">media</span>(.<span class="call">prefersColorScheme</span>(.<span class="dotAccess">light</span>))
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">themeColor</span>)
                    .<span class="call">content</span>(<span class="string">"#000"</span>)
                    .<span class="call">media</span>(.<span class="call">prefersColorScheme</span>(.<span class="dotAccess">dark</span>))
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">stylesheet</span>)
                    .<span class="call">href</span>(<span class="string">"/css/style.css"</span>)
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                    .<span class="call">href</span>(<span class="string">"/img/apple/icons/192.png"</span>)
                <span class="keyword">for</span> size <span class="keyword">in</span> [<span class="number">57</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">114</span>, <span class="number">120</span>, <span class="number">144</span>, <span class="number">152</span>, <span class="number">180</span>] {
                    <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                        .<span class="call">sizes</span>(<span class="string">"</span>\(size)<span class="string">x</span>\(size)<span class="string">"</span>)
                        .<span class="call">href</span>(<span class="string">"/img/apple/icons/</span>\(size)<span class="string">.png"</span>)
                }
            }
            <span class="type">Body</span> {
                <span class="type">Main</span> {
                    <span class="type">Div</span> {
                        <span class="type">H1</span>(context.<span class="property">title</span>)
                        <span class="type">P</span>(context.<span class="property">message</span>)
                    }
                }
            }
        }
    }
}</code></pre><p>Inside the style CSS file we can use a media query to detect the preferred color scheme, just like we did it for the .themeColor meta tag using SwiftHtml.</p><pre><code class="language-css">body {
    background: #fff;
    color: #000;
}
@media (prefers-color-scheme: dark) {
    body {
        background: #000;
        color: #fff;
    }
}
</code></pre><p>That's it, now the status bar should use the same color as your main background. Try to switch between dark and light mode and make sure everything works, there is a <a href="https://htmhelldev.netlify.app/theme-color-darkmode.html" target="_blank">cool PWA demo project here</a> with different colors for each mode if you want to double check the code. ‚úÖ</p><h2>Splash screen support</h2><p>Hint: it's ridiculous. Splash screens on iOS are problematic. Even native apps tend to cache the wrong splash screen or won't render PNG files properly, now if it comes to PWAs this isn't necessary better. I was able to provide splash screen images for my app, but it took me quite a while and switching between dark and light mode is totally broken (as far as I know it). üòÖ</p><p>In order to cover every single <a href="https://www.screensizes.app/" target="_blank">device screen size</a>, you have to add lots of linked splash images to your markup. It's so ugly I even had to create a bunch of extension methods to my index template.</p><pre><code class="language-swift"><span class="keyword">extension</span> <span class="type">IndexTemplate</span> {
    
    <span class="keyword">@TagBuilder
    func</span> splashTags() -&gt; [<span class="type">Tag</span>] {
        <span class="call">splash</span>(<span class="number">320</span>, <span class="number">568</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">320</span>, <span class="number">568</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">896</span>, <span class="number">3</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">896</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">375</span>, <span class="number">812</span>, <span class="number">3</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">896</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">375</span>, <span class="number">812</span>, <span class="number">3</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">736</span>, <span class="number">3</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">736</span>, <span class="number">3</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">375</span>, <span class="number">667</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">375</span>, <span class="number">667</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">1024</span>, <span class="number">1366</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">1024</span>, <span class="number">1366</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">834</span>, <span class="number">1194</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">834</span>, <span class="number">1194</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">834</span>, <span class="number">1112</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
        <span class="call">splash</span>(<span class="number">414</span>, <span class="number">896</span>, <span class="number">3</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">834</span>, <span class="number">1112</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">768</span>, <span class="number">1024</span>, <span class="number">2</span>, .<span class="dotAccess">portrait</span>)
        <span class="call">splash</span>(<span class="number">768</span>, <span class="number">1024</span>, <span class="number">2</span>, .<span class="dotAccess">landscape</span>)
    }
    
    <span class="keyword">@TagBuilder
    func</span> splash(<span class="keyword">_</span> width: <span class="type">Int</span>,
                <span class="keyword">_</span> height: <span class="type">Int</span>,
                <span class="keyword">_</span> ratio: <span class="type">Int</span>,
                <span class="keyword">_</span> orientation: <span class="type">MediaQuery</span>.<span class="type">Orientation</span>) -&gt; <span class="type">Tag</span> {
        <span class="call">splashTag</span>(.<span class="dotAccess">light</span>, width, height, ratio, orientation)
        <span class="call">splashTag</span>(.<span class="dotAccess">dark</span>, width, height, ratio, orientation)
    }
        
    <span class="keyword">func</span> splashTag(<span class="keyword">_</span> mode: <span class="type">MediaQuery</span>.<span class="type">ColorScheme</span>,
                   <span class="keyword">_</span> width: <span class="type">Int</span>,
                   <span class="keyword">_</span> height: <span class="type">Int</span>,
                   <span class="keyword">_</span> ratio: <span class="type">Int</span>,
                   <span class="keyword">_</span> orientation: <span class="type">MediaQuery</span>.<span class="type">Orientation</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchStartupImage</span>)
            .<span class="call">media</span>([
                .<span class="call">prefersColorScheme</span>(mode),
                .<span class="call">deviceWidth</span>(px: width),
                .<span class="call">deviceHeight</span>(px: height),
                .<span class="call">webkitDevicePixelRatio</span>(ratio),
                .<span class="call">orientation</span>(orientation),
            ])
            .<span class="call">href</span>(<span class="string">"/img/apple/splash/</span>\(<span class="call">calc</span>(width, height, ratio, orientation))\(mode == .<span class="dotAccess">light</span> ? <span class="string">""</span> : <span class="string">"_dark"</span>)<span class="string">.png"</span>)
    }
    
    <span class="keyword">func</span> calc(<span class="keyword">_</span> width: <span class="type">Int</span>,
              <span class="keyword">_</span> height: <span class="type">Int</span>,
              <span class="keyword">_</span> ratio: <span class="type">Int</span>,
              <span class="keyword">_</span> orientation: <span class="type">MediaQuery</span>.<span class="type">Orientation</span>) -&gt; <span class="type">String</span> {
        <span class="keyword">let</span> w = <span class="type">String</span>(width * ratio)
        <span class="keyword">let</span> h = <span class="type">String</span>(height * ratio)
        <span class="keyword">switch</span> orientation {
        <span class="keyword">case</span> .<span class="dotAccess">portrait</span>:
            <span class="keyword">return</span> w + <span class="string">"x"</span> + h
        <span class="keyword">case</span> .<span class="dotAccess">landscape</span>:
            <span class="keyword">return</span> h + <span class="string">"x"</span> + w
        }
    }
}</code></pre><p>Now I can simply add the splashTags() call into the head section, but I'm not sure if the result is something I can totally agree with. Here, take a look at the end of <a href="https://blog.expo.dev/enabling-ios-splash-screens-for-progressive-web-apps-34f06f096e5c" target="_blank">this tutorial about splash screens</a>, the code required to support iOS splash screens is very long and I haven't even told you about the 40 different image files that you'll need. People are literally using <a href="https://github.com/onderceylan/pwa-asset-generator/issues/51" target="_blank">PWA asset generators</a> to reduce the time needed to generate these kind of pictures, because it's quite out of control. üí©</p><h2>Safe area &amp; the notch</h2><p>A special topic I'd like to talk about is the safe area support and the notch. I can highly recommend to read this article on CSS-Tricks about <a href="https://css-tricks.com/the-notch-and-css/" target="_blank">The Notch and CSS</a> first, but the main trick is that we can use four environmental variables in CSS to set proper margin and padding values.</p><p>First we have to change the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag" target="_blank">viewport meta tag</a> and extend our page beyond the safe area. This can be done by using the viewport-fit cover value. Inside the body of the template we're going to add a header and a footer section, those areas will have custom background colors and fill the screen.</p><pre><code class="language-swift"><span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="keyword">let</span> context: <span class="type">IndexContext</span>
    
    <span class="keyword">init</span>(<span class="keyword">_</span> context: <span class="type">IndexContext</span>) {
        <span class="keyword">self</span>.<span class="property">context</span> = context
    }
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="type">Title</span>(context.<span class="property">title</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">charset</span>(<span class="string">"utf-8"</span>)
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">viewport</span>)
                    .<span class="call">content</span>(<span class="string">"width=device-width, initial-scale=1, viewport-fit=cover"</span>)
                    <span class="comment">//.content("width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no")</span>
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppCapable</span>)
                    .<span class="call">content</span>(<span class="string">"yes"</span>)
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">appleMobileWebAppTitle</span>)
                    .<span class="call">content</span>(<span class="string">"Hello PWA"</span>)
                
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">colorScheme</span>)
                    .<span class="call">content</span>(<span class="string">"light dark"</span>)
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">themeColor</span>)
                    .<span class="call">content</span>(<span class="string">"#fff"</span>)
                    .<span class="call">media</span>(.<span class="call">prefersColorScheme</span>(.<span class="dotAccess">light</span>))
                <span class="type">Meta</span>()
                    .<span class="call">name</span>(.<span class="dotAccess">themeColor</span>)
                    .<span class="call">content</span>(<span class="string">"#000"</span>)
                    .<span class="call">media</span>(.<span class="call">prefersColorScheme</span>(.<span class="dotAccess">dark</span>))
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">stylesheet</span>)
                    .<span class="call">href</span>(<span class="string">"/css/style.css"</span>)
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                    .<span class="call">href</span>(<span class="string">"/img/apple/icons/192.png"</span>)
                <span class="keyword">for</span> size <span class="keyword">in</span> [<span class="number">57</span>, <span class="number">72</span>, <span class="number">76</span>, <span class="number">114</span>, <span class="number">120</span>, <span class="number">144</span>, <span class="number">152</span>, <span class="number">180</span>] {
                    <span class="type">Link</span>(rel: .<span class="dotAccess">appleTouchIcon</span>)
                        .<span class="call">sizes</span>(<span class="string">"</span>\(size)<span class="string">x</span>\(size)<span class="string">"</span>)
                        .<span class="call">href</span>(<span class="string">"/img/apple/icons/</span>\(size)<span class="string">.png"</span>)
                }
                
                <span class="call">splashTags</span>()
            }
            <span class="type">Body</span> {
                <span class="type">Header</span> {
                    <span class="type">Div</span> {
                        <span class="type">P</span>(<span class="string">"Header area"</span>)
                    }
                    .<span class="call">class</span>(<span class="string">"safe-area"</span>)
                }
                
                <span class="type">Main</span> {
                    <span class="type">Div</span> {
                        <span class="type">Div</span> {
                            <span class="type">H1</span>(context.<span class="property">title</span>)
                            <span class="keyword">for _ in</span> <span class="number">0</span>...<span class="number">42</span> {
                                <span class="type">P</span>(context.<span class="property">message</span>)
                            }
                            <span class="type">A</span>(<span class="string">"Refresh page"</span>)
                                .<span class="call">href</span>(<span class="string">"/"</span>)
                        }
                        .<span class="call">class</span>(<span class="string">"wrapper"</span>)
                    }
                    .<span class="call">class</span>(<span class="string">"safe-area"</span>)
                }

                <span class="type">Footer</span> {
                    <span class="type">Div</span> {
                        <span class="type">P</span>(<span class="string">"Footer area"</span>)
                    }
                    .<span class="call">class</span>(<span class="string">"safe-area"</span>)
                }
            }
        }
    }
}</code></pre><p>Except the background color we don't want other content to flow outside the safe area, so we can define a new CSS class and place some margins on it based on the environment. Also we <a href="https://caniuse.com/?search=calc" target="_blank">can safely use the calc</a> CSS function if we want to add some extra value to the environment.</p><pre><code class="language-css">* {
    margin: 0;
    padding: 0;
}
body {
    background: #fff;
    color: #000;
}
header, footer {
    padding: 1rem;
}
header {
    background: #eee;
}
footer {
    background: #eee;
    padding-bottom: calc(1rem + env(safe-area-inset-bottom));
}
.safe-area {
    margin: 0 env(safe-area-inset-right) 0 env(safe-area-inset-left);
}
.wrapper {
    padding: 1rem;
}
@media (prefers-color-scheme: dark) {
    body {
        background: #000;
        color: #fff;
    }
    header {
        background: #222;
    }
    footer {
        background: #222;
    }
}
</code></pre><p>It looks nice, but what if we'd like to use custom styles for the PWA version only?</p><h2>Detecting standalone mode</h2><p>If you want to use the display mode media query in your CSS file we have to add a manifest file to our PWA. Yep, that's right, I've mentioned before that Apple prefers to use meta tags and links, but if you want to use a CSS media query to check if the app runs in a standalone mode you'll have to create a web manifest.json file with the following contents.</p><pre><code class="language-json">{
  "display": "standalone"
}
</code></pre><p>Next you have to provide a link to the manifest file inside the template file.</p><pre><code class="language-swift"><span class="keyword">struct</span> IndexTemplate: <span class="type">TemplateRepresentable</span> {
    
    <span class="comment">// ...</span>
    
    <span class="keyword">func</span> render(<span class="keyword">_</span> req: <span class="type">Request</span>) -&gt; <span class="type">Tag</span> {
        <span class="type">Html</span> {
            <span class="type">Head</span> {
                <span class="comment">// ...</span>
                
                <span class="call">splashTags</span>()
                
                <span class="type">Link</span>(rel: .<span class="dotAccess">manifest</span>)
                    .<span class="call">href</span>(<span class="string">"/manifest.json"</span>)
            }
            <span class="type">Body</span> {
                <span class="comment">// ...</span>
            }
        }
    }
}</code></pre><p>In the CSS file now you can use the display-mode selector to check if the app is running in a standalone mode, you can even combine these selectors and detect standalone mode and dark mode using a single query. <a href="https://www.w3schools.com/css/css_rwd_mediaqueries.asp" target="_blank">Media queries</a> are pretty useful. üòç</p><pre><code class="language-css">/* ... */

@media (display-mode: standalone) {
    header, footer {
        background: #fff;
    }
    header {
        position: sticky;
        top: 0;
        border-bottom: 1px solid #eee;
    }
}
@media (display-mode: standalone) and (prefers-color-scheme: dark) {
    header, footer {
        background: #000;
    }
    header {
        border-bottom: 1px solid #333;
    }
}
</code></pre><p>You can turn the header into a sticky section by using the position: sticky attribute. I usually prefer to follow the iOS style when the website is presented to the end-user as a standalone app and I keep the original theme colors for the web only.</p><p>Don't forget to rebuild the backend server, before you test your app. Since we've made some meta changes you might have to delete the PWA bookmark and install it again to make things work. ‚ö†Ô∏è</p><p>As you can see building good-looking progressive web apps for iOS is quite tricky, especially if it comes to the <a href="https://gist.github.com/eyecatchup/6dd1236ae6415b1180e9" target="_blank">metadata madness</a> that Apple created. Anyway, I hope this tutorial will help you to build better PWAs for the iOS platform. This is just the tip of the iceberg, we haven't talked about JavaScript at all, but maybe I'll come back with that topic in a new tutorial later on.</p>
        </section>
    </div>

</article>

<section id="share" class="content-wrapper">
    <p>
    <a
        href="https://twitter.com/intent/tweet?via=tiborbodecs&amp;hashtags=SwiftLang&amp;url=https://theswiftdev.com/progressive-web-apps-on-ios"
        target="_blank"
    >
        Share this article on Twitter
    </a>
    <br> Thank you. üôè</p>
</section>

<section  class="wrapper">
    <div id="book">
        <div class="column left">
            <img src="https://theswiftdev.com/assets/book/vapor.png">
        </div>
        <div class="column right">
            <h3>Get the Practical Server Side Swift book</h3>
            <p>Swift on the server is an amazing new opportunity to build fast, safe and scalable backend apps. Write your very first web-based application by using your favorite programming language. Learn how to build a modular blog engine using the latest version of the Vapor 4 framework. This book will help you to design and create modern APIs that'll allow you to share code between the server side and iOS. Start becoming a full-stack Swift developer.</p>
            <a class="button" href="https://gumroad.com/l/practical-server-side-swift" target="_blank">Available on Gumroad</a>
        </div>
    </div>
</section>

<section id="author" class="content-wrapper">
    <img 
        id="author-image"
        src="https://theswiftdev.com/images/profiles/tiborbodecs.jpg"
        alt="Picture of Tibor B√∂decs" 
        title="Tibor B√∂decs"
    >
    <h3>Tibor B√∂decs</h3>
    <p class="title">CEO @ <a href="https://binarybirds.com/">Binary Birds</a></p>
    <p class="bio">Server side Swift enthusiast, book author, content creator.</p>

    <div class="links">
        <a href="mailto:mail.tib@gmail.com?subject=theswiftdev.com" target="_blank">Email</a> ¬∑ 
        <a href="https://twitter.com/tiborbodecs" target="_blank">Twitter</a> ¬∑ 
        <a href="https://github.com/tib" target="_blank">GitHub</a> 
    </div>
</section>

        
    </main>

    <footer>
        <section class="content-wrapper">
            <img 
                src="https://theswiftdev.com/images/icons/icon-320.png"
                alt="Logo of The.Swift.Dev." 
                title="The.Swift.Dev."
            >

            <p>This site was generated using the <a href="https://swift.org/" target="_blank">Swift</a> programming language.</p>
            
            <p> 
                <a href="https://theswiftdev.com/">Home</a> ¬∑
                <a href="https://theswiftdev.com/rss.xml" target="_blank">RSS</a> ¬∑
                <a href="https://theswiftdev.com/sitemap.xml" target="_blank">Sitemap</a>
            </p>
            
            <p class="small">Created by Tibor B√∂decs &copy; 2015 - 2023.</p>
        </section>
    </footer>
</body>
</html>

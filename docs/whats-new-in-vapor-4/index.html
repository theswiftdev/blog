<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="canonical" href="https://theswiftdev.com/whats-new-in-vapor-4/">
    
    

    <title>What&#39;s new in Vapor 4? - The.Swift.Dev.</title>
    <meta name="description" content="Vapor is the most popular server side Swift web application framework. This time we&#39;ll cover what&#39;s new in Vapor 4.">

    <meta property="og:url" content="https://theswiftdev.com/whats-new-in-vapor-4/">
    <meta property="og:title" content="What&#39;s new in Vapor 4? - The.Swift.Dev.">
    <meta property="og:description" content="Vapor is the most popular server side Swift web application framework. This time we&#39;ll cover what&#39;s new in Vapor 4.">
    

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="What&#39;s new in Vapor 4? - The.Swift.Dev.">
    <meta name="twitter:description" content="Vapor is the most popular server side Swift web application framework. This time we&#39;ll cover what&#39;s new in Vapor 4.">
    

    <link rel="stylesheet" href="https://theswiftdev.com/css/modern-normalize.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/modern-base.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/variables.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/base.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/grid.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/navigation.css">
    <link rel="stylesheet" href="https://theswiftdev.com/css/footer.css">
    

    

    <link rel="shortcut icon" href="https://theswiftdev.com/icons/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://theswiftdev.com/icons/icon-320.png" type="image/png">
    
    <link rel="apple-touch-icon" href="https://theswiftdev.com/icons/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="57x57" href="https://theswiftdev.com/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://theswiftdev.com/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://theswiftdev.com/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://theswiftdev.com/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://theswiftdev.com/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://theswiftdev.com/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://theswiftdev.com/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://theswiftdev.com/icons/apple-touch-icon-180x180.png">

    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
        media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
        media="(prefers-color-scheme: dark)"
    >
    <link rel="stylesheet" href="https://theswiftdev.com/css/style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

</head>

<body>

    <div id="site-container">

    <header id="navigation">
        <a href="/">
            <picture>
                <img
                    src="https://theswiftdev.com/images/logos/logo.png"
                    alt="Logo of The.Swift.Dev."
                    title="The.Swift.Dev."
                >
            </picture>
        </a>
        <nav>
            <input type="checkbox" id="primary-menu-button" name="menu-button" class="menu-button">
            <label for="primary-menu-button">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </label>
            <div class="menu-items">
                <a href="/page/1/">Posts</a>
            <a href="/tags/">Tags</a>
            <a href="/authors/">Authors</a>
            <a href="/practical-server-side-swift/">My Book</a>
            </div>
        </nav>
    </header>

    <main id="page-container">
    
    <div class="article-with-toc">
        <div>
            <article class="post">
                <div class="meta">            
                    <time datetime="2019-08-26T16:20:00.000Z">8/26/19 4:20‚ÄØPM</time>
                     &middot; <span class="reading-time">4 min read</span>
                    
                </div>
                <h1>What&#39;s new in Vapor 4?</h1>
                <hr>
                <p>Vapor is the most popular server side Swift web application framework. This time we&#39;ll cover what&#39;s new in Vapor 4.</p>
                <section>
                
                <h2 id="swift-5.1">Swift 5.1</h2><p>Vapor 3 was built on top of some great new features of Swift 4.1, that‚Äôs why it was only released shortly (2 months) after the new programming language arrived. This is the exact same situation with Vapor 4. <a href="https://github.com/apple/swift-evolution/blob/master/proposals/0258-property-wrappers.md" target="_blank">Property wrappers</a> are heavily used in the latest version of the Vapor framework, this feature is only going to be finalized in Swift 5.1 during the fall, which means that we can expect <a href="https://medium.com/@codevapor/vapor-4-alpha-1-releases-begin-94a4bc79dd9a" target="_blank">Vapor 4 shortly after</a>. üçÅ</p><h2 id="swiftnio-v2-and-http2-support">SwiftNIO v2 and HTTP2 support</h2><p>A HUGE step forward and a long awaited feature, because HTTP2 is amazing. Multiplexed streams, server push, header compression, binary data format instead of the good old textual one over a secure layer by default. These are just a few important changes that the new protocol brings to the table. The basic implementation is already there in Vapor 4 alpha 2, I tried to setup my own HTTP2 server, but I faced a constant crash, as soon as I can make it work, I‚Äôll write a tutorial about it. ü§û</p><h2 id="fluent-is-amazing-in-vapor-4">Fluent is amazing in Vapor 4!</h2><p>Controllers now have an associated database object, this means you can query directly on this database, instead of the incoming request object. Note that the Future alias is now gone, it‚Äôs simply EventLoopFuture from SwiftNIO.</p><pre><code class="language-swift">// Vapor 3

import Vapor

/// Controls basic CRUD operations on `Todo`s.
final class TodoController {
    /// Returns a list of all `Todo`s.
    func index(_ req: Request) throws -&gt; Future&lt;[Todo]&gt; {
        return Todo.query(on: req).all()
    }

    /// Saves a decoded `Todo` to the database.
    func create(_ req: Request) throws -&gt; Future&lt;Todo&gt; {
        return try req.content.decode(Todo.self).flatMap { todo in
            return todo.save(on: req)
        }
    }

    /// Deletes a parameterized `Todo`.
    func delete(_ req: Request) throws -&gt; Future&lt;HTTPStatus&gt; {
        return try req.parameters.next(Todo.self).flatMap { todo in
            return todo.delete(on: req)
        }.transform(to: .ok)
    }
}

// Vapor 4

import Fluent
import Vapor

final class TodoController {
    let db: Database

    init(db: Database) {
        self.db = db
    }

    func index(req: Request) throws -&gt; EventLoopFuture&lt;[Todo]&gt; {
        return Todo.query(on: self.db).all()
    }

    func create(req: Request) throws -&gt; EventLoopFuture&lt;Todo&gt; {
        let todo = try req.content.decode(Todo.self)
        return todo.save(on: self.db).map { todo }
    }

    func delete(req: Request) throws -&gt; EventLoopFuture&lt;HTTPStatus&gt; {
        return Todo.find(req.parameters.get("todoID"), on: self.db)
            .unwrap(or: Abort(.notFound))
            .flatMap { $0.delete(on: self.db) }
            .transform(to: .ok)
    }
}
</code></pre><p>Fluent has dynamic models, also the entire database layer is more sophisticated. You can define your own keys, schemas and many more which I personally love it, because it reminds me of my really old PHP based web framework. It‚Äôs really amazing that you don‚Äôt have to deal the underlying database provider anymore. It‚Äôs just Fluent so it really doesn‚Äôt matter if it‚Äôs pgsql or sqlite under the hood. ‚ù§Ô∏è</p><pre><code class="language-swift">// Vapor 3

import FluentSQLite
import Vapor

/// A single entry of a Todo list.
final class Todo: SQLiteModel {
    /// The unique identifier for this `Todo`.
    var id: Int?

    /// A title describing what this `Todo` entails.
    var title: String

    /// Creates a new `Todo`.
    init(id: Int? = nil, title: String) {
        self.id = id
        self.title = title
    }
}

/// Allows `Todo` to be used as a dynamic migration.
extension Todo: Migration { }

/// Allows `Todo` to be encoded to and decoded from HTTP messages.
extension Todo: Content { }

/// Allows `Todo` to be used as a dynamic parameter in route definitions.
extension Todo: Parameter { }

// Vapor 4

import Fluent
import Vapor

final class Todo: Model, Content {
    static let schema = "todos"

    @ID(key: "id")
    var id: Int?

    @Field(key: "title")
    var title: String

    init() { }

    init(id: Int? = nil, title: String) {
        self.id = id
        self.title = title
    }
}
</code></pre><p>There is a brand new migration layer with a ridiculously easy to learn API. üëç</p><pre><code class="language-swift">import Fluent

struct CreateTodo: Migration {
    func prepare(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        return database.schema("todos")
            .field("id", .int, .identifier(auto: true))
            .field("title", .string, .required)
            .create()
    }

    func revert(on database: Database) -&gt; EventLoopFuture&lt;Void&gt; {
        return database.schema("todos").delete()
    }
}
</code></pre><h2 id="swiftlog">SwiftLog</h2><p>A <a href="https://github.com/apple/swift-log" target="_blank">native logger library</a> made by Apple is now the default logger in Vapor 4.</p><p>The entire logging system is bootstrapped during the boot process which I like quite a lot, because in the past I had some issues with the logger configuration in Vapor 3. ü§î</p><pre><code class="language-swift">import Vapor

func boot(_ app: Application) throws {
    try LoggingSystem.bootstrap(from: &app.environment)
    try app.boot()
}
</code></pre><h2 id="syntactic-sugar">‚ÄúSyntactic sugar‚Äù</h2><p>Some little changes were introduced in the latest version of the framework.</p><p>For example the input parameter names in the config and the routes file are just one letter long (you don‚Äôt need to type that much). I personally don‚Äôt like this, because we have auto-complete. I know, it‚Äôs just a template and I can change it, but still‚Ä¶ ü§ê</p><p>Another small change is that the entire application launch / configuration process is way more simple than it was before, plus from now on you can shut down your app server gracefully. Overall it feels like all the API‚Äôs in Vapor were polished just the right amount, I really like the changes so far. üòâ</p><h2 id="and-many-many-more">‚Ä¶ and many many more!</h2><p><a href="https://x.com/tanner0101" target="_blank">Tanner Nelson</a> posted quite a list on <a href="https://discord.gg/BnXmVGA" target="_blank">Vapor‚Äôs discord server</a> (it‚Äôs such an amazing community, you should join too). I‚Äôm going to shamelessly rip that off to show you most of the things that are going to be included in Vapor 4. Here is the list:</p><h3 id="vapor">Vapor</h3><ul><li>services on controllers</li><li>synchronous content decoding</li><li>upload / download streaming</li><li>backpressure</li><li>http/2</li><li>extensible route builder (for openapi)</li><li>apple logging</li><li>improved session syntax</li><li>dotenv support</li><li>validation included</li><li>authentication included</li><li>XCTVapor testing module</li><li>swift server http client</li><li>simplified websocket endpoints</li><li>graceful shutdown</li><li>nio 2</li></ul><h3 id="consolekit">ConsoleKit</h3><ul><li>type safe signatures</li></ul><h3 id="routingkit">RoutingKit</h3><ul><li>performance improvements</li><li>performance testing bot</li></ul><h3 id="fluent">Fluent</h3><ul><li>dynamic models</li><li>simplified driver requirements</li><li>eager loading: join + subquery</li><li>partial selects</li><li>dirty updates</li></ul><h3 id="leafkit">LeafKit</h3><ul><li>improved body syntax</li><li>separate lexer + parser</li></ul><h3 id="toolbox">Toolbox</h3><ul><li>dynamic project init</li></ul><h2 id="how-to-set-up-a-vapor-4-project-on-macos">How to set up a Vapor 4 project (on macOS)?</h2><p>If you want to play around with Vapor 4, you can do it right now. You just have to install <a href="https://developer.apple.com/develop/" target="_blank">Xcode 11</a>, the <a href="https://docs.vapor.codes/3.0/getting-started/toolbox/" target="_blank">Vapor toolbox</a> and run the following command from Terminal:</p><pre><code>#optional: select Xcode 11
sudo xcode-select --switch /Applications/Xcode-beta.app/Contents/Developer

#create a brand new Vapor 4 project
vapor new myproject --branch=4
cd myproject
vapor update -y
</code></pre><p>Personally I really love these new changes in Vapor, especially the HTTP2 support and the new Fluent abstraction. Vapor 3 was quite a big hit, I believe that this trend will continue with Vapor 4, because it‚Äôs going to be a really nice refinement update. üíß</p><p>I can‚Äôt wait to see some new benchmarks, because of the underlying changes in vapor, plus all the optimizations in Swift 5.1 will have such a nice impact on the overall performance. Vapor 3 was already crazy fast, but <a href="https://forums.swift.org/t/whats-new-in-vapor-4/31832" target="_blank">Vapor 4 will be on fire</a>! üî•</p>
                    
                </section>
    
                <footer>
                    <br>
                    <time datetime=""></time>
    
                    
                    <div class="author-list">
                        <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                        <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                        </a>
                    </div>
                    <div class="tag-list">
                        <a href="https://theswiftdev.com/tags/server/"><small>Server</small></a>
                    <a href="https://theswiftdev.com/tags/vapor/"><small>Vapor</small></a>
                    </div>
                    
                    <p>
                        <a href="https://x.com/intent/tweet?via=tiborbodecs&amp;hashtags=SwiftLang&amp;url=https://theswiftdev.com/whats-new-in-vapor-4/" target="_blank">
                            <strong>Share this article</strong>
                        </a>
                        <br>Thank you. üôè
                    </p>
                </footer>
                            
                <section class="group">
                    <h4>Related posts</h4>                
                    <div class="grid grid-221">
                        <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2019-10-08T16:20:00.000Z">10/8/19 4:20‚ÄØPM</time>
                                 &middot; <span class="reading-time">4 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/a-simple-http2-server-using-vapor-4/" target="">A simple HTTP/2 server using Vapor 4</a></h2>
                            <hr>
                            <p>Get started with server-side Swift using the Vapor 4 framework. Learn how to build a really simple HTTP/2 backend server.</p>
                        
                            <div class="tag-list">
                                <a href="https://theswiftdev.com/tags/server/"><small>Server</small></a>
        <a href="https://theswiftdev.com/tags/vapor/"><small>Vapor</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2019-08-26T16:20:00.000Z">8/26/19 4:20‚ÄØPM</time>
                                 &middot; <span class="reading-time">4 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/whats-new-in-vapor-4/" target="">What&#39;s new in Vapor 4?</a></h2>
                            <hr>
                            <p>Vapor is the most popular server side Swift web application framework. This time we&#39;ll cover what&#39;s new in Vapor 4.</p>
                        
                            <div class="tag-list">
                                <a href="https://theswiftdev.com/tags/server/"><small>Server</small></a>
        <a href="https://theswiftdev.com/tags/vapor/"><small>Vapor</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2020-07-15T16:20:00.000Z">7/15/20 4:20‚ÄØPM</time>
                                 &middot; <span class="reading-time">5 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/10-short-advices-that-will-make-you-a-better-vapor-developer-right-away/" target="">10 short advices that will make you a better Vapor developer right away</a></h2>
                            <hr>
                            <p>As a beginner server side Swift developer you&#39;ll face many obstackles. I&#39;ll show you how to avoid the most common ones.</p>
                        
                            <div class="tag-list">
                                <a href="https://theswiftdev.com/tags/server/"><small>Server</small></a>
        <a href="https://theswiftdev.com/tags/vapor/"><small>Vapor</small></a>
                            </div>
                        </div>
                    <div class="card">
                            
                            
                            <div class="author-list">
                                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                                </a>
                            </div>
                            <div class="meta">
                                <time datetime="2020-04-01T16:20:00.000Z">4/1/20 4:20‚ÄØPM</time>
                                 &middot; <span class="reading-time">10 min read</span>
                            </div>
                            
                            <h2 class="title"><a href="https://theswiftdev.com/a-generic-crud-solution-for-vapor-4/" target="">A generic CRUD solution for Vapor 4</a></h2>
                            <hr>
                            <p>Learn how to build a controller component that can serve models as JSON objects through a RESTful API written in Swift.</p>
                        
                            <div class="tag-list">
                                <a href="https://theswiftdev.com/tags/server/"><small>Server</small></a>
        <a href="https://theswiftdev.com/tags/vapor/"><small>Vapor</small></a>
                            </div>
                        </div>
                    </div>
                </section>
    
            </article>
        </div>
        
        <div>
            <div class="book">
                <a href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">
                    <img src="https://theswiftdev.com/book/practical-server-side-swift-cover.png" alt="Practical Server Side Swift cover image">
                </a>
                <h3>
                    <a href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">Get the Practical Server Side Swift book</a>
                </h3>
                <p>Swift on the server is an amazing new opportunity to build fast, safe and scalable backend apps. Write your very first web-based application by using your favorite programming language. Learn how to build a modular blog engine using the latest version of the Vapor 4 framework. This book will help you to design and create modern APIs that'll allow you to share code between the server side and iOS. Start becoming a full-stack Swift developer.</p>
                <a class="cta" href="https://theswiftdev.gumroad.com/l/practical-server-side-swift" target="_blank">Available on Gumroad</a>
            </div>
            
            
            <aside id="toc">
                <h4>On this page</h4>
                <ul>
                    <li class="level-2">
                        <a href="#swift-5.1">Swift 5.1</a>
                    </li>
        <li class="level-2">
                        <a href="#swiftnio-v2-and-http2-support">SwiftNIO v2 and HTTP2 support</a>
                    </li>
        <li class="level-2">
                        <a href="#fluent-is-amazing-in-vapor-4">Fluent is amazing in Vapor 4!</a>
                    </li>
        <li class="level-2">
                        <a href="#swiftlog">SwiftLog</a>
                    </li>
        <li class="level-2">
                        <a href="#syntactic-sugar">‚ÄúSyntactic sugar‚Äù</a>
                    </li>
        <li class="level-2">
                        <a href="#and-many-many-more">‚Ä¶ and many many more!</a>
                    </li>
        <li class="level-3">
                        <a href="#vapor">Vapor</a>
                    </li>
        <li class="level-3">
                        <a href="#consolekit">ConsoleKit</a>
                    </li>
        <li class="level-3">
                        <a href="#routingkit">RoutingKit</a>
                    </li>
        <li class="level-3">
                        <a href="#fluent">Fluent</a>
                    </li>
        <li class="level-3">
                        <a href="#leafkit">LeafKit</a>
                    </li>
        <li class="level-3">
                        <a href="#toolbox">Toolbox</a>
                    </li>
        <li class="level-2">
                        <a href="#how-to-set-up-a-vapor-4-project-on-macos">How to set up a Vapor 4 project (on macOS)?</a>
                    </li>
                </ul>
            </aside>
            
    
        </div>
    </div>
    
    </main>

    <footer id="site-footer">
        <div class="grid grid-421">
    
            <picture>
                <img
                    id="logo-image"
                    src="https://theswiftdev.com/images/logos/logo-large.png"
                    alt="Logo of The.Swift.Dev."
                    title="The.Swift.Dev."
                >
            </picture>
            
            <div>
                <span style="display: block; height: 32px;">&nbsp;</span>
                <h4>The.Swift.Dev</h4>
                <p><small><a href="https://theswiftdev.com/" target="_blank">theswiftdev.com</a></small></p>
                <ul>
                    <li><a href="https://github.com/theswiftdev/" target="_blank">GitHub</a></li>
                    <li><a href="https://theswiftdev.com/rss.xml" target="_blank">RSS</a></li>
                    <li><a href="https://theswiftdev.com/sitemap.xml" target="_blank">Sitemap</a></li>
                </ul>
            </div>
            
            <div>
                
            </div>
            
            <div>
                <a href="https://theswiftdev.com/authors/tibor-bodecs/">
                <img class="small rounded" src="https://theswiftdev.com/assets/authors/tibor-bodecs/tibor-bodecs.jpeg" alt="Tibor B√∂decs">
                </a>
                <h4><a href="https://theswiftdev.com/authors/tibor-bodecs/">Tibor B√∂decs</a></h4>
                <p><small><a href="https://binarybirds.com/" target="_blank">Binary Birds Kft.</a></small></p>
                <ul>
                    <li><a href="mailto:mail.tib@gmail.com" target="_blank">Email</a></li>
                    <li><a href="https://github.com/tib/" target="_blank">GitHub</a></li>
                    <li><a href="https://x.com/tiborbodecs" target="_blank">X (Twitter)</a></li>
                    <li><a href="https://mastodon.social/@tiborbodecs" target="_blank">Mastodon</a></li>
                </ul>
            </div>
            
        </div>
        
        <section class="grid grid-221">
            <small>Tibor B√∂decs &copy; 2015 - 2025</small>
            <small>This site was generated using <a href="https://swift.org/" target="_blank">Swift</a> & <a href="https://github.com/binarybirds/toucan" target="_blank">Toucan</a>.</small>
        </section>
    </footer>

    </div>

    
</body>
</html>
